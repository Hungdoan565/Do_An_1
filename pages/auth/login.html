<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đăng Nhập - Món Ngon Việt Nam</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/assets/css/pages/login.css" />
<script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.8.0/firebase-auth-compat.js"></script>
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
      <div class="container">
        <a class="navbar-brand" href="/index.html">
          <img
            src="/assets/images/logo.png"
            height="40"
            class="me-2"
            alt="Logo"
          />
          Món Ngon Việt Nam
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item">
              <a class="nav-link" href="/index.html">Trang chủ</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/pages/recipes/list.html">Công thức</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="/pages/blog.html">Blog</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/pages/about.html">Về chúng tôi</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/pages/auth/login.html"
                >Đăng nhập</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/pages/auth/register.html"
                >Đăng ký</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Login Section -->
    <div class="login-container">
      <div class="container">
        <div class="login-card">
          <div class="row g-0">
            <div class="col-md-6">
              <div class="login-image">
                <div>
                  <h2 class="display-6 fw-bold mb-4">Chào Mừng Trở Lại</h2>
                  <p class="lead">Khám phá và chia sẻ công thức nấu ăn ngon</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="login-form">
                <h3 class="fw-bold mb-4">Đăng Nhập</h3>
                <form id="loginForm">
                  <div class="mb-4">
                    <label class="form-label">Email hoặc tên tài khoản</label>
                    <!-- Đăng nhập bằng email hoặc tên tài khoản (username) -->
                    <input
                      type="text"
                      class="form-control"
                      id="loginId"
                      name="loginId"
                      placeholder="Email hoặc tên tài khoản"
                      required
                    />
                  </div>
                  <div class="mb-4">
                    <label class="form-label">Mật khẩu</label>
                    <input
                      type="password"
                      class="form-control"
                      id="password"
                      placeholder="Nhập mật khẩu"
                    />
                  </div>
                  <div class="remember-me">
                    <div class="form-check">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="rememberCheck"
                      />
                      <label class="form-check-label" for="rememberCheck"
                        >Ghi nhớ đăng nhập</label
                      >
                    </div>
                    <a href="#" class="forgot-password">Quên mật khẩu?</a>
                  </div>
                  <button type="submit" class="btn btn-primary w-100">
                    Đăng nhập
                  </button>
                </form>

                <div class="divider">
                  <span>hoặc đăng nhập với</span>
                </div>

                <div class="social-login">
                  <a href="#" class="social-btn facebook-btn">
                    <i class="fab fa-facebook-f"></i>
                  </a>
                  <a href="#" class="social-btn google-btn">
                    <i class="fab fa-google"></i>
                  </a>
                </div>

                <p class="text-center mt-4">
                  Chưa có tài khoản?
                  <a
                    href="/pages/auth/register.html"
                    class="text-decoration-none"
                    style="color: var(--primary-color)"
                  >
                    Đăng ký ngay
                  </a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="text-center">
          <p class="mb-0">© 2024 Món Ngon Việt Nam. Đã đăng ký bản quyền.</p>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="/assets/js/firebase-config.js"></script>
    <script src="/assets/js/auth.js"></script>
    <script>
      document
        .getElementById("loginForm")
        ?.addEventListener("submit", function (e) {
          e.preventDefault();
          const loginId = document.getElementById("loginId").value.trim();
          const password = document.getElementById("password").value;
          let result;
          if (/^\S+@\S+\.\S+$/.test(loginId)) {
            // Đăng nhập bằng email
            result = window.loginUser({ email: loginId, password });
          } else {
            // Đăng nhập bằng username
            result = window.loginUser({ username: loginId, password });
          }
          if (result.success) {
            const user = result.user;
            if (user.role === "admin") {
              window.location.href = "/pages/admin/dashboard.html";
            } else {
              const params = new URLSearchParams(window.location.search);
              const redirect = params.get("redirect") || "/index.html";
              window.location.href = redirect;
            }
          } else {
            alert(result.message);
          }
        });

      // Google Login
      document
        .querySelector(".social-btn.google-btn")
        ?.addEventListener("click", function (e) {
          e.preventDefault();
          // Gọi hàm đăng nhập Google từ auth.js
          if (window.googleSignIn) {
            window.googleSignIn();
          } else {
            // fallback: click vào nút login Google nếu có
            document.querySelector(".btn-google")?.click();
          }
        });
    </script>
  </body>
</html>
